<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot UI with API and Models</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='chatstyle.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');


    /* Slide down effect for the alert */
    @keyframes slideDown {
        0% {
            transform: translateY(-50px);
            opacity: 0;
        }

        100% {
            transform: translateY(0);
            opacity: 1;
        }
    }

    /* Fade-in animation */
    @keyframes fadeIn {
        0% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

    /* Blur effect when the alert is active */
    body.blur-active .container {
        filter: blur(8px);
        pointer-events: none;
        /* Disable interactions with the blurred content */
    }

    /* Main alert box styling */
    #custom-alert {
        position: fixed;
        top: 50%;
        left: 50%;
        font-family: 'Poppins', sans-serif;
        transform: translate(-50%, -50%);
        background-color: #fff;
        color: #333;
        padding: 30px 20px;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        min-width: 320px;
        text-align: center;
        /* Center the text */
        display: flex;
        flex-direction: column;
        align-items: center;
        /* Align content vertically */
        animation: slideDown 0.5s ease, fadeIn 0.5s ease;
        opacity: 1;
    }

    /* Hidden state for the alert */
    .alert-hidden {
        opacity: 0;
        visibility: hidden;
    }

    .alert-visible {
        opacity: 1;
        visibility: visible;
    }

    /* Heading and paragraph styling */
    #custom-alert h2 {
        font-weight: 600;
        font-size: 24px;
        margin-bottom: 15px;
        color: #e74c3c;
        /* Red color for emphasis */
    }

    #custom-alert p {
        font-weight: 400;
        font-size: 16px;
        color: #555;
        margin-bottom: 25px;
    }

    /* Button styling */
    .home-btn {
        background-color: #697565;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        font-size: 16px;
        font-weight: 600;
    }

    .home-btn:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    }

    .choices-container {
        margin-top: 10px;
    }

    .choice-btn {
        position: relative;
        overflow: hidden;
        background-color: #616361;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        margin: 5px;
        transition: background-color 0.3s ease, transform 0.3s ease;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    }

    .choice-btn:hover {
        background-color: #5a654b;
        transform: scale(1.05);
        box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.3);
    }

    .choice-btn:active::after {
        content: "";
        display: block;
        position: absolute;
        width: 300%;
        height: 300%;
        background: rgba(255, 255, 255, 0.2);
        top: 50%;
        left: 50%;
        pointer-events: none;
        transform: translate(-50%, -50%) scale(0);
        border-radius: 50%;
        animation: ripple 0.6s ease-out;
    }

    @keyframes ripple {
        0% {
            transform: translate(-50%, -50%) scale(0);
            opacity: 1;
        }

        100% {
            transform: translate(-50%, -50%) scale(1);
            opacity: 0;
        }
    }

    .choice-btn.disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    input[type="date"] {
        flex: 1;
        padding: 10px;
        border: 1px solid #e5e5ea;
        border-radius: 20px;
        background-color: #EEEEEE;
        color: #3C3D37;
        outline: none;
        font-size: 18px;
        margin-right: 10px;
        appearance: none;
        /* Remove default styling in some browsers */
    }

    input[type="date"]::-webkit-calendar-picker-indicator {
        /* Optional: Change background for the date picker */
        border: none;
        /* Optional: Remove border */
        color: #32332e;
        /* Optional: Change color of the indicator */
    }

    /* Additional styling to remove the default arrow in Firefox */
    input[type="date"]::-moz-inner-spin-button {
        display: none;
    }

    input[type="number"] {
        flex: 1;
        padding: 10px;
        border: 1px solid #e5e5ea;
        border-radius: 20px;
        background-color: #EEEEEE;
        color: #3C3D37;
        outline: none;
        font-size: 18px;
        margin-right: 10px;
        appearance: none;
        /* Remove default styling in some browsers */
    }

    /* Optional: Style for the spinner buttons in Chrome */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        /* Remove default spinner */
        margin: 0;
        /* Reset margin */
    }
</style>

<body>
    <div id="custom-alert" class="alert-hidden">
        <div class="alert-content">
            <h2>Oops! Something went wrong</h2>
            <p>Groq Internal server error. Please try again with another model or api key.</p>
            <button class="home-btn" onclick="refreshing()">Try Again</button>
        </div>
    </div>

    <div class="container">
        <div class=main-sidebar>
            <div class="sidebar" id="sidebar">
                <h2>Available Operation</h2>
                <ul id="lists"></ul>
            </div>
        </div>

        <button onclick="window.location.reload();" class="toggle-sidebar-refesh" id="refreshBtn">&#128472;</button>

        <button class="toggle-sidebar-btn" id="toggleBtn">â˜°</button>
        <div style="width:100%;">
            <div class="top-right-container">
                <div style="display: flex; gap: 1px; align-items: center;">
                    <div style="width: 50px;"></div>
                    <div id="profile-info">
                        <p id="employee-id">Employee ID: Loading...</p>
                    </div>
                </div>
                <div class="ff">
                    <div class="dropdown" id="apikey-dropdown">
                        <div class="default" onclick="toggleDropdown('apikey')">GROQ_API_KEY1</div>
                        <ul id="apikey-list" class="dropdown-content">
                            <li onclick="selectOption('apikey', 'GROQ_API_KEY1')">GROQ_API_KEY1</li>
                            <li onclick="selectOption('apikey', 'GROQ_API_KEY2')">GROQ_API_KEY2</li>
                            <li onclick="selectOption('apikey', 'GROQ_API_KEY3')">GROQ_API_KEY3</li>
                            <li onclick="selectOption('apikey', 'GROQ_API_KEY4')">GROQ_API_KEY4</li>
                        </ul>
                    </div>
                    <div class="dropdown" id="models-dropdown">
                        <div class="default" onclick="toggleDropdown('models')">Mistral</div>
                        <ul id="models-list" class="dropdown-content">
                            <li onclick="selectOption('models', 'mixtral-8x7b-32768')">Mistral</li>
                            <li onclick="selectOption('models', 'llama3-70b-8192')">LLAMA70b</li>
                            <li onclick="selectOption('models', 'llama3-8b-8192')">LLAMA8b</li>
                        </ul>
                    </div>
                    <button id="logout-button" class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            <div class="main-content">
                <div class="headerbox">
                    <p id="welcome-message" class="para">Loading...</p>
                </div>
                <div class="chat-container">
                    <div class="chat-box" id="chat-box">
                        <div id="initial">
                            <p>Hello, Please ask a query related to the topics mentioned in available operations:</p>
                            <p>Enter 'quit' to end the session.</p>
                        </div>
                    </div>
                    <div class="input-box">
                        <input type="text" id="user-input" placeholder="Type a message..." disabled>
                        <button id="send-button" onclick="sendMessage()" disabled>Send</button>
                    </div>
                </div>

            </div>

        </div>

    </div>

    <script>
        let active_enter;
        let message;
        console.log("active_enter", active_enter)
        document.addEventListener('DOMContentLoaded', function () {
            document.addEventListener('keypress', function (event) {
                if (event.key === 'Enter' && event.target.tagName === 'INPUT' && active_enter) {
                    event.preventDefault(); // Prevent Enter key from doing anything in any input fields
                    console.log("Enter key is globally disabled for input fields.");
                }
            });
        });
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const roleElement = document.getElementById('role');
        const employeeIdElement = document.getElementById('employee-id');
        const initialMessage = document.getElementById('initial');
        let employeeId = null;
        let role = null;

        const token = localStorage.getItem('token');
        console.log(token);

        if (token) {
            fetchProfileInfo(token);
        } else {
            document.getElementById('welcome-message').innerText = "Refresh Bot!";
            enableInput(); // Enable input if no token is found (for testing or guest mode)
        }

        async function fetchProfileInfo(token) {
            try {
                const response = await fetch('https://converse-chatbot-be-dev-951891e59e91.herokuapp.com/profile/', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch profile info');
                }

                const profile = await response.json();
                employeeId = profile.Employee_ID;
                role = profile.Role;

                employeeIdElement.innerText = `Employee ID: ${employeeId}`;

                setTimeout(() => {
                    (profile.Functions || []).forEach((data) => {
                        const list = document.getElementById("lists");
                        const listItem = document.createElement("li");
                        listItem.innerHTML = data;
                        list.appendChild(listItem);
                    });
                }, 1000);

                document.getElementById('welcome-message').innerText = `Welcome to Employee Chat Application!`;
                enableInput(); // Enable the input field and send button after fetching profile info

            } catch (error) {
                document.getElementById('welcome-message').innerText = "Welcome!";
                console.error(error);
                enableInput(); // Enable input even if fetching profile fails
            }
        }


        function refreshing() {
            window.location.href = "/index.html";
        };

        function showAlert(message) {
            const alertDiv = document.getElementById('custom-alert');
            alertDiv.querySelector('h2').textContent = message;
            alertDiv.classList.remove('alert-hidden');
            alertDiv.classList.add('alert-visible');
            document.body.classList.add('blur-active'); // Add blur effect
        }

        function hideAlert() {
            const alertDiv = document.getElementById('custom-alert');
            alertDiv.classList.remove('alert-visible');
            alertDiv.classList.add('alert-hidden');
            document.body.classList.remove('blur-active'); // Remove blur effect
        }

        function refreshing() {
            window.location.href = "/index.html";
        }

        // Example: show the alert on page load after 2 seconds


        function enableInput() {
            userInput.disabled = false;
            sendButton.disabled = false;
        }

        const websocket = new WebSocket("wss://employee-chat-fe-model-dev-221d3977ca1e.herokuapp.com/ws/chat");

        websocket.onopen = () => {
            console.log("WebSocket connection established.");
        };

        websocket.onmessage = (event) => {
             message = event.data;

            // Check if the message starts with <!DOCTYPE html> indicating HTML content
            if (message.startsWith("<!DOCTYPE html>")) {
                // Create a temporary element to safely insert the HTML content
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = message;

                // Extract the table from the temporary element
                const table = tempDiv.querySelector('table');
                const otherContent = tempDiv.innerHTML;

                // Append table or other content with specific styling
                if (table) {
                    chatBox.innerHTML += `<div class="table-wrapper">${table.outerHTML}</div>`;
                } else {
                    chatBox.innerHTML += `<div class="message-content">${otherContent}</div>`;
                }
            }
            else if (message.includes("Choices are:")) {
                const promptMessage = message.split("Choices are:");
                const choices = promptMessage[1].trim();

                // Display the initial bot message
                addMessageWithChoices(promptMessage[0].trim(), choices);
            }
            else if (message.includes('Fields')) {
                console.log(message)
                const field = message.split("Fields:")
                console.log(field)
                const fieldList = field[1]
                const data = field[0]
                addMessageUpdateChoices(data, fieldList)
            }
            else if (message === "navigateerror") {
                showAlert("An error occurred. Please try again.");
            }
            else if (message === "navigateerror") {
                showAlert("An error occurred. Please try again.");
            } else if (message === "quit") {
                showAlert("You are about to leave this page.");
            }  else if (message.includes("datatype")) { // Assuming your message contains the datatype
                console.log(message);
                let description, datatype, regexFormat;

                // Extract the description before 'datatype:'
                description = message.split("datatype:")[0].trim();
                console.log("Description:", description);  // "Please provide Email address of the employee."

                // Check if the message contains 'regexformat:'
                if (message.includes("regexformat:")) {
                    // Extract and store the datatype
                    datatype = message.split("datatype:")[1].split(",")[0].trim();  // Extract datatype value
                    console.log("Datatype:", datatype);

                    // Extract and store the regex format
                    regexFormat = message.split("regexformat:")[1].trim();  // Extract regexformat value
                    console.log("Regex Format:", regexFormat);
                    handleDatatypeInput(description, datatype, regexFormat); // Pass description, datatype, and regex format
                } else {
                    datatype = message.split("datatype:")[1].trim();  // Extract datatype without regex
                    handleDatatypeInput(description, datatype);  // Call the function without regexformat
                }
            } else {
                // Handle other types of messages
                addMessageChat(message, 'bot');
            }

        };


        function handleDatatypeInput(message, type, regexFormat = null) {
            const datatype = type.trim(); // Get the datatype
            const description = message; // Message description
            console.log("datatype:", datatype);
            console.log("description:", description);
            // Display the prompt message
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', 'bot');
            messageDiv.textContent = description;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
            // Set input restrictions based on the datatype
            if (datatype === 'integer') {
                userInput.setAttribute('type', 'number');
                userInput.setAttribute('inputmode', 'numeric');
                userInput.setAttribute('pattern', '[0-9]*');
            } else if (datatype === 'date') {
                userInput.setAttribute('type', 'date');
            } else if (datatype === 'mobile') {
                userInput.setAttribute('type', 'number'); // Keep as text for mobile validation
            }

            // If regex format is provided, set it as the input pattern
            if (regexFormat) {
                userInput.setAttribute('pattern', regexFormat); // Set custom regex pattern
            }

            // Input validation function
            console.log("1");
            const validateInput = function () {
                let isValid = true;
                console.log("2");
                // Check if the input matches the expected data type
                if (datatype === 'mobile') {
                    console.log("3");
                    isValid = /^\d{10}$/.test(userInput.value); // Validate for exactly 10 digits
                    userInput.style.borderColor = isValid ? 'green' : 'red'; // Set border color based on validity
                } else if (datatype === 'integer') {
                    console.log("4");
                    isValid = /^-?\d+$/.test(userInput.value.trim()); // Validate if the input is a valid integer
                    userInput.style.borderColor = isValid ? 'green' : 'red'; // Set border color based on validity
                } else if (datatype === 'date') {
                    console.log("5");
                    // Check if the input has a valid date selected
                    if (userInput.valueAsDate) {
                        const dateValue = userInput.valueAsDate; // Get the date object from the input
                        const day = String(dateValue.getDate()).padStart(2, '0'); // Get the day, padded to 2 digits
                        const month = String(dateValue.getMonth() + 1).padStart(2, '0'); // Get the month (0-indexed), padded to 2 digits
                        const year = dateValue.getFullYear(); // Get the year
                        const formattedDate = `${day}/${month}/${year}`;
                        console.log("Formatted date:", formattedDate);
                        isValid = true; // The date is valid
                        userInput.style.borderColor = 'green'; // Set border color to green to indicate valid input
                    } else {
                        userInput.style.borderColor = 'red'; // Set border color to red if no valid date is selected
                        isValid = false;
                    }
                } else if (regexFormat) {
                    console.log("Regex Validation");
                    const regex = new RegExp(regexFormat);
                    isValid = regex.test(userInput.value); // Validate against custom regex pattern
                    userInput.style.borderColor = isValid ? 'green' : 'red';
                } else {
                    console.log("6");
                    // Reset to default border color for unsupported datatypes
                    userInput.style.borderColor = '';
                }

                sendButton.disabled = !isValid; // Disable button if input is invalid
                active_enter = isValid
            };

            // Add the input event listener
            userInput.addEventListener('input', validateInput);
            // Prevent form submission with "Enter" key if the input is invalid
            /*userInput.addEventListener('keypress', function (event) {
                console.log("red")
                if (event.key === 'Enter' && sendButton.disabled && active_enter) {
                    event.preventDefault(); // Prevent form submission
                }
            });*/
            // Function to clean up after message is sent
            const cleanup = function () {
                // Remove the input listener
                userInput.removeEventListener('input', validateInput);
                // Reset input type and attributes
                userInput.setAttribute('type', 'text'); // Reset to default type
                userInput.removeAttribute('pattern');
                userInput.removeAttribute('inputmode');
                userInput.style.borderColor = ''; // Reset border color
                sendButton.disabled = true; // Disable send button again
            };
            // Assuming you have a send button logic
            sendButton.onclick = function () {
                sendMessage();
                chatBox.scrollTop = chatBox.scrollHeight;
                userInput.removeEventListener('input', validateInput);
                userInput.setAttribute('type', 'text'); // Reset to default type
                userInput.removeAttribute('pattern');
                userInput.removeAttribute('inputmode');
                userInput.style.borderColor = ''; // Reset border color
                sendButton.disabled = true;
                console.log("Message sent:", userInput.value);
                //sendMessage(); // Implement the function to handle sending the message
                cleanup(); // Clean up after sending the message
            };
            console.log("end");
            userInput.addEventListener('keypress', function (event) {
                console.log("blue")
                if (event.key === 'Enter' && userInput.value !== "" && active_enter) { // Check if the pressed key is Enter
                    console.log("inblue")
                    event.preventDefault(); // Prevent default Enter key behavior
                    if (!sendButton.disabled) {
                        sendButton.onclick(); // Trigger the send button click only if input is valid
                    } else {
                        console.log("Input invalid, message not sent.");
                    }
                }
            });
        }


        function addMessageUpdateChoices(message, choices) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', 'bot');
            messageDiv.textContent = message;

            // Create a container for the choice buttons
            const choicesContainer = document.createElement('div');
            choicesContainer.classList.add('choices-container');
            choicesContainer.innerHTML = '';

            // Split choices into an array and create buttons
            const choicesArray = choices.split(','); // Assuming choices are comma-separated
            console.log("cjhsd", choicesArray)
            choicesArray.forEach((choice) => {
                const choiceButton = document.createElement('button'); // Create a button for each choice
                choiceButton.textContent = choice.trim(); // Set the button text
                choiceButton.classList.add('choice-btn'); // Add a class for styling
                choiceButton.setAttribute('data-value', choice.trim()); // Set a data attribute for the button's value

                if (choice.trim() === "All") {
                    choiceButton.addEventListener('click', () => {
                        // Send the text "All" when the button is clicked
                        sendMessageRadio("All");
                        userInput.value = '';

                        // Enable input after choice selection
                        userInput.disabled = false;
                        sendButton.disabled = false;
                        disableChoicesContainer(choicesContainer);

                    });
                } else {
                    choiceButton.addEventListener('click', () => {
                        handleMultiChoiceSelection(choice.trim());

                        const handleEnterOrSend = (event) => {
                            if (event.key === 'Enter' || event.type === 'click') {
                                sendMessageRadio(userInput.value); // Send the selected choices in the input field
                                userInput.value = ''; // Clear input after sending

                                // Disable the buttons and prevent further interaction
                                disableChoicesContainer(choicesContainer);

                                // Remove the event listeners to avoid multiple triggers
                                userInput.removeEventListener('keydown', handleEnterOrSend);
                                sendButton.removeEventListener('click', handleEnterOrSend);
                            }
                        };

                        // Remove previous listeners to prevent duplication
                        userInput.removeEventListener('keydown', handleEnterOrSend);
                        sendButton.removeEventListener('click', handleEnterOrSend);

                        // Attach event listeners for both Enter and Send button click
                        userInput.addEventListener('keydown', handleEnterOrSend);
                        sendButton.addEventListener('click', handleEnterOrSend);
                    });
                }

                choicesContainer.appendChild(choiceButton); // Append the button to the container
            });

            // Append the choices container inside the bot message
            messageDiv.appendChild(choicesContainer);

            // Add the bot message with choices to the chat box
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight; // Scroll to the bottom after adding choices

            // Disable input until a choice is selected
            userInput.disabled = true;
            sendButton.disabled = true;
        }

        // Function to handle the user's choice selection
        let selectedChoices = [];
        console.log(selectedChoices)
        function handleMultiChoiceSelection(choice) {
            // Check if the choice is already in the array
            const index = selectedChoices.indexOf(choice);

            if (index === -1) {
                // If the choice is not in the array, add it
                selectedChoices.push(choice);
            } else {
                // If the choice is already in the array, remove it
                selectedChoices.splice(index, 1);
            }

            // Update the input box to show the selected choices
            userInput.value = selectedChoices.join(', ');

            // Enable the input and send button for additional typing or sending
            userInput.disabled = false;
            sendButton.disabled = false;
        }
        function addMessageWithChoices(message, choices) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', 'bot');
            messageDiv.textContent = message;

            // Create a container for the choice buttons
            const choicesContainer = document.createElement('div');
            choicesContainer.classList.add('choices-container');

            // Split choices into an array and create buttons
            const choicesArray = choices.split(','); // Assuming choices are comma-separated
            console.log("cjhsd", choicesArray)
            choicesArray.forEach((choice) => {
                const choiceButton = document.createElement('button'); // Create a button for each choice
                choiceButton.textContent = choice.trim(); // Set the button text
                choiceButton.classList.add('choice-btn'); // Add a class for styling
                choiceButton.setAttribute('data-value', choice.trim()); // Set a data attribute for the button's value

                // Add click event listener to handle choice selection
                choiceButton.addEventListener('click', () => {
                    handleChoiceSelection(choice.trim());

                    disableChoicesContainer(choicesContainer);
                });

                choicesContainer.appendChild(choiceButton); // Append the button to the container
            });

            // Append the choices container inside the bot message
            messageDiv.appendChild(choicesContainer);

            // Add the bot message with choices to the chat box
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight; // Scroll to the bottom after adding choices

            // Disable input until a choice is selected
            userInput.disabled = true;
            sendButton.disabled = true;
        }

        // Function to handle the user's choice selection
        function handleChoiceSelection(choice) {

            // Enable input after choice selection
            userInput.disabled = false;
            sendButton.disabled = false;
            sendMessageRadio(choice);


        }
        function sendMessageRadio(message = null) {
            // Use the message from the choice button if provided, otherwise get the input value
            const userMessage = message || userInput.value.trim();

            if (userMessage === "") return;  // If the message is empty, don't send

            if (initialMessage) {
                initialMessage.style.display = 'none';
            }
            const lastChoicesContainer = document.querySelector('.choices-container:last-child');
            if (lastChoicesContainer) {
                disableOtherChoices(lastChoicesContainer);  // Disable previous buttons
            }


            // Get the selected API Key and Model
            const selectedApiKey = document.querySelector('#apikey-dropdown .default').innerText;
            const selectedModel = document.querySelector('#models-dropdown .default').innerText;

            addMessageToChat(userMessage, 'user');

            // Create the payload with the selected API Key and Model
            const payload = {
                message: userMessage,
                employee_id: employeeId,
                role: role,
                token: token,
                apikey: selectedApiKey,  // Add the API Key to the payload
                model: selectedModel      // Add the Model to the payload
            };
            console.log('payload', payload);

            // Send the payload via WebSocket
            websocket.send(JSON.stringify(payload));

            // Clear the input field only if the message came from the input box
            if (!message) {
                userInput.value = "";
            }
        }
        function disableChoicesContainer(container) {
            const buttons = container.querySelectorAll('.choice-btn');
            buttons.forEach(button => {
                button.disabled = true; // Disable each button
                button.classList.add('disabled'); // Optionally, add a disabled class for styling
            });
        }
        function disableOtherChoices(container) {
            const buttons = container.querySelectorAll('.choice-btn');
            buttons.forEach(button => {
                button.disabled = true;  // Disable all buttons in the container
                button.classList.add('disabled');  // Add a CSS class to visually indicate disabled state
            });
        }


        function sendMessage() {
            let message;
            if (userInput.valueAsDate) {
                const dateValue = userInput.valueAsDate; // Get the date object from the input
                const day = String(dateValue.getDate()).padStart(2, '0'); // Get the day, padded to 2 digits
                const month = String(dateValue.getMonth() + 1).padStart(2, '0'); // Get the month (0-indexed), padded to 2 digits
                const year = dateValue.getFullYear(); // Get the year

                // Reformat the date to dd/mm/yyyy
                message = `${day}/${month}/${year}`;
            } else {

                message = userInput.value;
            }
            if (message.trim() === "") return;

            if (initialMessage) {
                initialMessage.style.display = 'none';
            }

            // Get the selected API Key and Model
            const selectedApiKey = document.querySelector('#apikey-dropdown .default').innerText;
            console.log(selectedApiKey)
            const selectedModel = document.querySelector('#models-dropdown .default').innerText;

            addMessageToChat(message, 'user');

            // Create the payload with the selected API Key and Model
            const payload = {
                message: message,
                employee_id: employeeId,
                role: role,
                token: token,
                apikey: selectedApiKey,  // Add the API Key to the payload
                model: selectedModel      // Add the Model to the payload
            };
            console.log('payload', payload);

            // Send the payload via WebSocket
            websocket.send(JSON.stringify(payload));

            userInput.value = "";
        }


        function addMessageToChat(message, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender);
            messageElement.classList.add('regular-message'); // Apply a specific class for regular messages
            messageElement.innerHTML = message; // Use innerHTML to render HTML content
            chatBox.appendChild(messageElement);

            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && userInput.type === "text" && typeof message === 'string' && !message.includes("datatype")) {
                console.log("sdas", userInput.type);
                sendMessage();
            }
        });

        function addMessageChat(message, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender);
            messageElement.classList.add('message-content'); // Apply a specific class for all message types
            messageElement.innerHTML = message; // Use innerHTML to render HTML content

            // Check if the message contains a table
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = message;
            const table = tempDiv.querySelector('table');

            if (table) {
                // Add a specific class for tables to apply unique styles
                messageElement.classList.add('table-message');
            }

            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && userInput.type == "text" && !message) {
                sendMessage();
            }
        });

        function toggleDropdown(field) {
            const dropdowns = document.querySelectorAll('.dropdown-content');
            dropdowns.forEach(dropdown => {
                if (dropdown.id !== field + '-list') {
                    dropdown.style.display = 'none';
                }
            });

            const dropdown = document.getElementById(field + '-list');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function selectOption(field, value) {
            const defaultElement = document.querySelector('#' + field + '-dropdown .default');
            defaultElement.innerText = value;
            toggleDropdown(field);
        }



        //afdsfd
        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('toggleBtn');
            const refreshBtn = document.getElementById('refreshBtn');


            // Function to toggle the sidebar visibility
            function toggleSidebar() {
                sidebar.classList.toggle('sidebar-hidden');
                toggleBtn.classList.toggle('sidebar-open');
                refreshBtn.classList.toggle('sidebar-open');

            }

            // Event listener for the toggle button
            toggleBtn.addEventListener('click', toggleSidebar);

            // Function to handle responsive behavior
            function handleResize() {
                if (window.innerWidth <= 980) {
                    if (!sidebar.classList.contains('sidebar-hidden')) {
                        // Sidebar is open and screen is small, close it
                        sidebar.classList.add('sidebar-hidden');
                        toggleBtn.classList.add('sidebar-open');
                        refreshBtn.classList.add('sidebar-open');
                    }
                } else {
                    // Screen is larger, ensure sidebar is visible
                    sidebar.classList.remove('sidebar-hidden');
                    toggleBtn.classList.remove('sidebar-open');
                    refreshBtn.classList.remove('sidebar-open');
                }
            }

            // Add event listener for window resize
            window.addEventListener('resize', handleResize);

            // Initial check to set the sidebar state on page load
            handleResize();
        });

        // Close dropdown if clicked outside
        window.onclick = function (event) {
            if (!event.target.matches('.default')) {
                const dropdowns = document.querySelectorAll('.dropdown-content');
                dropdowns.forEach(dropdown => dropdown.style.display = 'none');
            }
        }

        function logout() {
            // Clear the token from localStorage
            localStorage.removeItem('token');

            // Redirect to the login page
            window.location.href = '/index.html';  // Update the URL as per your application routing
        }
    </script>
</body>

</html>